<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cmhb.module.auth.dao.UserDao">
    <resultMap id="BaseResultMap" type="com.cmhb.module.auth.domain.User">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Aug 08 10:46:32 CST 2017.
        -->
        <id column="id" jdbcType="BIGINT" property="id"/>
        <result column="login_name" jdbcType="VARCHAR" property="loginName"/>
        <result column="password" jdbcType="VARCHAR" property="password"/>
        <result column="username" jdbcType="VARCHAR" property="username"/>
        <result column="email" jdbcType="VARCHAR" property="email"/>
        <result column="phone" jdbcType="VARCHAR" property="phone"/>
        <result column="mobile" jdbcType="VARCHAR" property="mobile"/>
        <result column="description" jdbcType="VARCHAR" property="description"/>
        <result column="sales" jdbcType="BIT" property="sales"/>
        <result column="checking" jdbcType="BIT" property="checking"/>
        <result column="receipt" jdbcType="BIT" property="receipt"/>
        <result column="driver" jdbcType="BIT" property="driver"/>
        <result column="branch_company" jdbcType="VARCHAR" property="branchCompany"/>
        <result column="entry_time" jdbcType="TIMESTAMP" property="entryTime"/>
        <result column="duty_status" jdbcType="BIT" property="dutyStatus"/>
        <result column="resign_time" jdbcType="TIMESTAMP" property="resignTime"/>
        <result column="status" jdbcType="TINYINT" property="status"/>
        <result column="add_time" jdbcType="TIMESTAMP" property="addTime"/>
        <result column="mod_time" jdbcType="TIMESTAMP" property="modTime"/>
        <result column="department_id" jdbcType="BIGINT" property="departmentId"/>
        <result column="position_id" jdbcType="BIGINT" property="positionId"/>
    </resultMap>

    <sql id="Base_Column_List">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Aug 08 10:46:32 CST 2017.
        -->
        id, login_name, password, username, email, phone, mobile, description, sales, checking,
        receipt, driver, branch_company, entry_time, duty_status,
        resign_time, status, add_time, mod_time, department_id, position_id
    </sql>

    <update id="changePasswd" parameterType="com.cmhb.module.auth.domain.User">
        UPDATE auth_user
        SET
        password = #{password,jdbcType=VARCHAR}
        WHERE id = #{id,jdbcType=BIGINT}
    </update>
    <update id="changeAuthInfo" parameterType="com.cmhb.module.auth.domain.User">
        UPDATE auth_user
        SET
        login_name = #{loginName,jdbcType=VARCHAR},
        password = #{password,jdbcType=VARCHAR}
        WHERE id = #{id,jdbcType=BIGINT}
    </update>
    <update id="logoffPosition" parameterType="map">
        UPDATE auth_user
        SET position_id = null
        WHERE position_id= #{positionId}
        AND id in
        <foreach collection="userIds" item="item" open="(" separator="," close=")">
          ${item}
        </foreach>
    </update>
    <select id="selectPage" resultMap="BaseResultMap">
        select t1.*
        from auth_user t1
        <if test="dutyId != null">
            , auth_r_user_duty t2
        </if>
        <where>
            <if test="id != null">
                and t1.id = #{id,jdbcType=BIGINT}
            </if>
            <if test="loginName != null">
                and t1.login_name = #{loginName,jdbcType=VARCHAR}
            </if>
            <if test="password != null">
                and t1.password = #{password,jdbcType=VARCHAR}
            </if>
            <if test="username != null">
                and t1.username = #{username,jdbcType=VARCHAR}
            </if>
            <if test="email != null">
                and t1.email = #{email,jdbcType=VARCHAR}
            </if>
            <if test="phone != null">
                and t1.phone = #{phone,jdbcType=VARCHAR}
            </if>
            <if test="mobile != null">
                and t1.mobile = #{mobile,jdbcType=VARCHAR}
            </if>
            <if test="sales != null">
                and t1.sales = #{sales,jdbcType=BIT}
            </if>
            <if test="checking != null">
                and t1.checking = #{checking,jdbcType=BIT}
            </if>
            <if test="receipt != null">
                and t1.receipt = #{receipt,jdbcType=BIT}
            </if>
            <if test="driver != null">
                and t1.driver = #{driver,jdbcType=BIT}
            </if>
            <if test="branchCompany != null">
                <choose>
                    <when test="branchCompany == 0">
                        and t1.branch_company IS NULL
                    </when>
                    <otherwise>
                        and t1.branch_company = #{branchCompany,jdbcType=VARCHAR}
                    </otherwise>
                </choose>
            </if>
            <if test="entryTime != null">
                and t1.entry_time = #{entryTime,jdbcType=TIMESTAMP}
            </if>
            <if test="dutyStatus != null">
                and t1.duty_status = #{dutyStatus,jdbcType=BIT}
            </if>
            <if test="resignTime != null">
                and t1.resign_time = #{resignTime,jdbcType=TIMESTAMP}
            </if>
            <if test="status != null">
                and t1.status = #{status,jdbcType=TINYINT}
            </if>
            <if test="addTime != null">
                and t1.add_time = #{addTime,jdbcType=TIMESTAMP}
            </if>
            <if test="modTime != null">
                and t1.mod_time = #{modTime,jdbcType=TIMESTAMP}
            </if>
            <if test="departmentId != null">
                and t1.department_id = #{departmentId,jdbcType=BIGINT}
            </if>
            <if test="positionId != null">
                and t1.position_id = #{positionId,jdbcType=BIGINT}
            </if>
            <if test="dutyId != null">
                and t2.duty_id = #{dutyId}
                and t1.id = t2.user_id
            </if>
        </where>
    </select>
    <select id="selectWithLikeNoOrName" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from auth_user
        <where>
            <if test="noLike != null">
                AND id like CONCAT('%', #{noLike}, '%')
            </if>
            <if test="nameLike != null">
                AND username like CONCAT('%', #{nameLike}, '%')
            </if>
            <if test="positionId != null">
                AND position_id = #{positionId}
            </if>
        </where>
    </select>

    <update id="doUpdateUser">
      UPDATE auth_user
        <set>
            position_id = null
        </set>
        WHERE id = #{id, jdbcType=BIGINT}
    </update>
</mapper>
